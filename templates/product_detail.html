{% extends "layout.html" %}

{% block title %}{{ product.name }} - Comprar em Paragominas{% endblock %}

{% block seo_tags %}
    <meta name="description" content="Compre {{ product.name }} na Suporte Smart em Paragominas. {{ product.description|striptags|truncate(120, True) }}">
    <link rel="canonical" href="{{ url_for('product_detail', product_id=product.id, _external=True) }}">
    <meta property="og:type" content="product">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:title" content="{{ product.name }} - Suporte Smart Paragominas">
    <meta property="og:description" content="{{ product.description|striptags|truncate(150, True) }}">
    <meta property="og:image" content="{{ url_for('static', filename='product_pics/' ~ (product.image_file or 'default.png'), _external=True) }}">
{% endblock %}

{% block content %}
<main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
    <!-- coluna da galeria -->
    <div class="animate-on-scroll">
      {% set main_src = url_for('static', filename='product_pics/' + (product.image_file or 'default.png')) %}
      <div class="card product-media mb-4 overflow-hidden">
        <img id="main-image" src="{{ main_src }}" alt="Imagem principal de {{ product.name }} - Suporte Smart" class="w-full h-full object-cover">
      </div>

      {% if product.images %}
        <div class="grid grid-cols-4 sm:grid-cols-5 gap-2">
          <div>
            <img src="{{ main_src }}" alt="Thumbnail de {{ product.name }} - Suporte Smart" class="thumbnail-image w-full h-24 object-cover cursor-pointer rounded-md border-2 border-blue-500" onclick='changeImage("{{ main_src }}", this)'>
          </div>
          {% for image in product.images %}
            {% set thumb_src = url_for('static', filename='product_pics/' + image.image_filename) %}
            <div>
              <img src="{{ thumb_src }}" alt="Thumbnail de {{ product.name }} - Suporte Smart" class="thumbnail-image w-full h-24 object-cover cursor-pointer rounded-md border-2 border-transparent hover:border-blue-500 transition-all" onclick='changeImage("{{ thumb_src }}", this)'>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <!-- coluna de detalhes -->
    <div class="animate-on-scroll" data-delay-index="1">
      <h1 class="text-3xl md:text-4xl font-extrabold text-slate-800 mb-4">{{ product.name }}</h1>
      <div class="mb-6">
        <span class="text-2xl font-bold text-primary">Consulte o preço</span>
      </div>

      <div class="mb-8 max-w-2xl">
        <p class="text-slate-600 leading-relaxed whitespace-pre-wrap">{{ product.description | safe }}</p>
      </div>

      <div class="space-y-4 mt-8">
        <!-- formulário em linha: quantidade no canto esquerdo e botão ao lado -->
        <form action="{{ url_for('add_to_cart', product_id=product.id) }}" method="POST" class="add-to-cart-form flex items-center justify-start gap-4">
            <label for="quantity" class="font-bold text-slate-700">Quantidade:</label>
            <input type="number" id="quantity" name="quantity" value="1" min="1" class="w-20 px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">

            <button type="submit" class="btn btn-primary flex items-center gap-3 px-6 py-3 rounded-lg text-lg hover:bg-primary-dark transition duration-300">
              <!-- ícone de carrinho restaurado -->
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
              Adicionar ao Carrinho
            </button>
        </form>

        <!-- botão Voltar com o mesmo visual (mas full-width) -->
        <a href="{{ back_url or url_for('home', _anchor='loja') }}" class="block w-full text-center bg-primary text-white font-bold py-4 rounded-lg text-lg hover:bg-primary-dark transition duration-300 mt-4">
          Voltar para a Loja
        </a>
      </div>
    </div>
  </div>
</main>

<script>
function changeImage(newSrc, clickedThumbnail) {
  const mainImage = document.getElementById('main-image');
  mainImage.style.opacity = '0';
  setTimeout(() => {
    mainImage.src = newSrc;
    mainImage.style.opacity = '1';
  }, 300);
  const thumbnails = document.querySelectorAll('.thumbnail-image');
  thumbnails.forEach(thumb => { thumb.classList.remove('border-blue-500'); thumb.classList.add('border-transparent'); });
  clickedThumbnail.classList.remove('border-transparent');
  clickedThumbnail.classList.add('border-blue-500');
}
</script>
{% endblock %}
